<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="SXS Collaboration">
    <meta name="generator" content="Doxygen 1.8.13"/>
    <style>
        /*!
         * IE10 viewport hack for Surface/desktop Windows 8 bug
         * Copyright 2014-2015 Twitter, Inc.
         * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
         */
        @-webkit-viewport { width: device-width; }
        @-moz-viewport    { width: device-width; }
        @-ms-viewport     { width: device-width; }
        @-o-viewport      { width: device-width; }
        @viewport         { width: device-width; }
      </style>
  <title>SpECTRE: Option Parsing</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js", "color.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
MathJax.Hub.Config({
    TeX: { equationNumbers: { autoNumber: "AMS" } }
});
MathJax.Hub.Config({
    tex2jax: {inlineMath: [['^^','^^'], ['\\(', '\\)']]}
});
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
  <link href="octicons.css" rel="stylesheet">
  <link href="bootstrap.min.css" rel="stylesheet">
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="bootstrap.min.js"></script>
  <script type="text/javascript" src="spectre.js"></script>
  </head>
  <body>
  <div id="top" class="navbar-fixed-top"><!-- do not remove this div, it is closed by doxygen! -->
  <!-- BEGIN TITLEAREA -->
  <div id="titlearea">
  <script type="text/javascript">
  var searchBox = new SearchBox("searchBox", "search",false,'Search');
  </script>
  <div id="main-nav">
    <ul class="sm sm-dox" id="main-menu">
      <li>
      <a href="index.html">
      SpECTRE &#160;
        <span id="projectnumber">v0.0.0</span>
      </a>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="selected">
          <span id="selected">
            <i class="octicon octicon-book"></i><span>Documentation</span>
          </span>
          <span class="caret"></span>
        </a>
        <ul class="dropdown-menu">
          <li style="min-width: 135px;">
            <a href="index.html">
            <i class="octicon octicon-book"></i><span>Introduction</span></a>
          </li>
          <li style="min-width: 135px;">
            <a href="installation.html">
              <i class="octicon octicon-desktop-download"></i><span>Installation</span>
            </a>
          </li>
          <li style="min-width: 135px;">
            <a href="tutorials.html">
              <i class="octicon octicon-mortar-board"></i><span>User Tutorials</span>
            </a>
          </li>
          <li style="min-width: 135px;">
            <a href="dev_guide.html">
              <i class="octicon octicon-gist-secret"></i><span>Dev Guide</span>
            </a>
          </li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="selected">
          <span id="selected">
            <i class="octicon octicon-code"></i>
              <span>Reference</span>
          </span>
          <span class="caret"></span>
        </a>
        <ul class="dropdown-menu">
          <li style="min-width: 130px;">
            <a href="modules.html">
              <i class="octicon octicon-code"></i>
              <span>Topics</span>
            </a>
          </li>
          <li style="min-width: 130px;">
            <a href="namespaces.html">
              <i class="octicon octicon-gist"></i>
              <span>Namespaces</span>
            </a>
          </li>
        </ul>
      </li>
      <li>
        <a href="files.html">
          <i class="octicon octicon-file-directory"></i><span>Files</span>
        </a>
      </li>
      <li>
        <a href="https://github.com/sxs-collaboration/spectre" target="_blank">
          <i class="octicon octicon-mark-github"></i><span>View on GitHub</span>
        </a>
      </li>
      <!--The Search <li> is added by doxygen later-->
    </ul>
  </div><!-- main-nav -->
  </div><!-- titlearea -->
  <!-- window showing the filter options -->
  <div id="MSearchSelectWindow"  style="position: fixed;"
       onmouseover="return searchBox.OnSearchSelectShow()"
       onmouseout="return searchBox.OnSearchSelectHide()"
       onkeydown="return searchBox.OnSearchSelectKey(event)">
  </div>
  <!-- iframe showing the search results (closed by default) -->
  <div id="MSearchResultsWindow"  style="position: fixed;">
  <iframe src="javascript:void(0)" frameborder="0"
          name="MSearchResults" id="MSearchResults">
  </iframe>
  </div>
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="classOption.html" title="The type that options are passed around as. Contains YAML node data and an OptionContext. ">Option</a> Parsing </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>SpECTRE can read YAML configuration files at runtime to set parameters and choose between classes implementing an interface. Options are parsed during code initialization and can be used to construct objects placed in the <a class="el" href="classParallel_1_1ConstGlobalCache.html" title="A Charm++ chare that caches constant data once per Charm++ node. ">Parallel::ConstGlobalCache</a> and options passed to the parallel components. The types necessary to mark objects for parsing are declared in <code><a class="el" href="Options_8hpp.html" title="Defines classes and functions for making classes creatable from input files. ">Options/Options.hpp</a></code>.</p>
<h2>General option format</h2>
<p>An option is defined by an "option struct". The name of the struct (excluding any template parameters and scope information) is the name that will be expected in the input file. At minimum, the struct must declare the type of the object to be parsed and provide a brief description of the meaning. Several other pieces of information, such as defaults and limits, may be provided if desired. This information is all included in the generated help output.</p>
<p>Examples: </p><div class="fragment"><div class="line"><span class="keyword">struct </span>Bounded {</div><div class="line">  <span class="keyword">using</span> type = int;</div><div class="line">  <span class="keyword">static</span> constexpr <a class="code" href="Options_8hpp.html#ac6df7d1b74fbddedd85b06a0087d93f6">OptionString</a> help = {</div><div class="line">    <span class="stringliteral">&quot;Option with bounds and a default value&quot;</span>};</div><div class="line">  <span class="comment">// These are optional</span></div><div class="line">  <span class="keyword">static</span> type default_value() { <span class="keywordflow">return</span> 3; }</div><div class="line">  <span class="keyword">static</span> type <a class="codeRef" doxygen="/work/spectre/docs/config/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/algorithm/lower_bound.html">lower_bound</a>() { <span class="keywordflow">return</span> 2; }</div><div class="line">  <span class="keyword">static</span> type <a class="codeRef" doxygen="/work/spectre/docs/config/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/algorithm/upper_bound.html">upper_bound</a>() { <span class="keywordflow">return</span> 10; }</div><div class="line">};</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keyword">struct </span>Vector {</div><div class="line">  <span class="keyword">using</span> type = <a class="codeRef" doxygen="/work/spectre/docs/config/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;int&gt;</a>;</div><div class="line">  <span class="keyword">static</span> constexpr <a class="code" href="Options_8hpp.html#ac6df7d1b74fbddedd85b06a0087d93f6">OptionString</a> help = {<span class="stringliteral">&quot;A vector with length limits&quot;</span>};</div><div class="line">  <span class="comment">// These are optional</span></div><div class="line">  <span class="keyword">static</span> <span class="keywordtype">size_t</span> lower_bound_on_size() { <span class="keywordflow">return</span> 2; }</div><div class="line">  <span class="keyword">static</span> <span class="keywordtype">size_t</span> upper_bound_on_size() { <span class="keywordflow">return</span> 5; }</div><div class="line">};</div></div><!-- fragment --><p> The option type can be any type understood natively by yaml-cpp (fundamentals, <code><a class="elRef" doxygen="/work/spectre/docs/config/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a></code>, and <code><a class="elRef" doxygen="/work/spectre/docs/config/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/container/map.html">std::map</a></code>, <code><a class="elRef" doxygen="/work/spectre/docs/config/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector</a></code>, <code><a class="elRef" doxygen="/work/spectre/docs/config/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/container/list.html">std::list</a></code>, <code><a class="elRef" doxygen="/work/spectre/docs/config/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/container/array.html">std::array</a></code>, and <code><a class="elRef" doxygen="/work/spectre/docs/config/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/utility/pair.html">std::pair</a></code> of parsable types) and types SpECTRE adds support for. SpECTRE adds <code><a class="elRef" doxygen="/work/spectre/docs/config/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/container/unordered_map.html">std::unordered_map</a></code> (but only with ordered keys), and various classes marked as constructible in their declarations.</p>
<h2>Constructible classes</h2>
<p>A class that defines <code>static constexpr OptionString help</code> and a typelist of option structs <code>options</code> can be created by the option parser. When the class is requested, the option parser will parse each of the options in the <code>options</code> list, and then supply them to the constructor of the class. (See <a href="#custom-parsing">Custom parsing</a> below for more general creation mechanisms.)</p>
<p>Unlike option descriptions, which should be brief, the class help string has no length limits and should give a description of the class and any necessary discussion of its options beyond what can be described in their individual help strings.</p>
<p>Creatable classes must be default constructible and move assignable.</p>
<p>Example: </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>&gt;</div><div class="line"><span class="keyword">class </span>CreateFromOptions;</div><div class="line"><span class="keyword">struct </span>CFO {</div><div class="line">  <span class="keyword">using</span> type = CreateFromOptions&lt;int&gt;;</div><div class="line">  <span class="keyword">static</span> constexpr <a class="code" href="Options_8hpp.html#ac6df7d1b74fbddedd85b06a0087d93f6">OptionString</a> help = {<span class="stringliteral">&quot;help&quot;</span>};</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="keyword">class </span>CreateFromOptions {</div><div class="line"> <span class="keyword">public</span>:</div><div class="line">  <span class="keyword">struct </span><a class="code" href="classOption.html">Option</a> {</div><div class="line">    <span class="keyword">using</span> type = <a class="codeRef" doxygen="/work/spectre/docs/config/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a>;</div><div class="line">    <span class="keyword">static</span> constexpr <a class="code" href="Options_8hpp.html#ac6df7d1b74fbddedd85b06a0087d93f6">OptionString</a> help = {<span class="stringliteral">&quot;Option help text&quot;</span>};</div><div class="line">  };</div><div class="line">  <span class="keyword">using</span> options = tmpl::list&lt;Option&gt;;</div><div class="line">  <span class="keyword">static</span> constexpr <a class="code" href="Options_8hpp.html#ac6df7d1b74fbddedd85b06a0087d93f6">OptionString</a> help = {<span class="stringliteral">&quot;Class help text&quot;</span>};</div><div class="line"></div><div class="line">  CreateFromOptions() = <span class="keywordflow">default</span>;</div><div class="line">  <span class="comment">// The OptionContext argument can be left off if unneeded.</span></div><div class="line">  CreateFromOptions(<a class="codeRef" doxygen="/work/spectre/docs/config/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> str, <span class="keyword">const</span> <a class="code" href="structOptionContext.html">OptionContext</a>&amp; context)</div><div class="line">      : str_(<a class="code" href="namespacestd.html">std</a>::move(str)) {</div><div class="line">    <span class="keywordflow">if</span> (str_[0] != <span class="charliteral">&#39;f&#39;</span>) {</div><div class="line">      <a class="code" href="group__OptionParsingGroup.html#ga2724ed7a660af53bf365f99878d79c82">PARSE_ERROR</a>(context, <span class="stringliteral">&quot;Option must start with an f&quot;</span>);</div><div class="line">    }</div><div class="line">  }</div><div class="line"></div><div class="line">  <a class="codeRef" doxygen="/work/spectre/docs/config/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> str_;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> input_file_text = R<span class="stringliteral">&quot;(</span></div><div class="line"><span class="stringliteral">CFO:</span></div><div class="line"><span class="stringliteral">  Option: foo</span></div><div class="line"><span class="stringliteral">)&quot;;</span></div></div><!-- fragment --> <h2>Factory</h2>
<p>The factory interface creates an object of type <code><a class="elRef" doxygen="/work/spectre/docs/config/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/memory/unique_ptr.html">std::unique_ptr</a>&lt;Base&gt;</code> containing a pointer to some class derived from <code>Base</code>. The base class must define a type alias listing the derived classes that can be created. </p><div class="fragment"><div class="line"><span class="keyword">using</span> creatable_classes = tmpl::list&lt;Derived1, ...&gt;;</div></div><!-- fragment --><p> The requested derived class is created in the same way as an explicitly constructible class.</p>
<h2><a class="anchor" id="custom-parsing"></a>Custom parsing</h2>
<p>Occasionally, the requirements imposed by the default creation mechanism are too stringent. In these cases, the construction algorithm can be overridden by providing a specialization of the struct </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="keyword">struct </span><a class="code" href="structcreate__from__yaml.html">create_from_yaml</a> {</div><div class="line">  <span class="keyword">static</span> T create(<span class="keyword">const</span> <a class="code" href="classOption.html">Option</a>&amp; options);</div><div class="line">};</div></div><!-- fragment --><p> The create function can perform any operations required to construct the object.</p>
<p>Example of using a specialization to parse an enum: </p><div class="fragment"><div class="line"><span class="keyword">namespace </span>{</div><div class="line"><span class="keyword">enum class</span> CreateFromOptionsAnimal { Cat, Dog };</div><div class="line"></div><div class="line"><span class="keyword">struct </span>CFOAnimal {</div><div class="line">  <span class="keyword">using</span> type = CreateFromOptionsAnimal;</div><div class="line">  <span class="keyword">static</span> constexpr <a class="code" href="Options_8hpp.html#ac6df7d1b74fbddedd85b06a0087d93f6">OptionString</a> help = {<span class="stringliteral">&quot;Option help text&quot;</span>};</div><div class="line">};</div><div class="line">}  <span class="comment">// namespace</span></div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;&gt;</div><div class="line"><span class="keyword">struct </span><a class="code" href="structcreate__from__yaml.html">create_from_yaml</a>&lt;CreateFromOptionsAnimal&gt; {</div><div class="line">  <span class="keyword">static</span> CreateFromOptionsAnimal <a class="code" href="group__DataBoxGroup.html#ga190fd7a31cd2424701e03faea2d03247">create</a>(<span class="keyword">const</span> <a class="code" href="classOption.html">Option</a>&amp; options) {</div><div class="line">    <span class="keyword">const</span> <a class="codeRef" doxygen="/work/spectre/docs/config/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> animal = options.<a class="code" href="classOption.html#a2aadd03c7089362d776e7bb0e24d7e08">parse_as</a>&lt;<a class="codeRef" doxygen="/work/spectre/docs/config/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a>&gt;();</div><div class="line">    <span class="keywordflow">if</span> (animal == <span class="stringliteral">&quot;Cat&quot;</span>) {</div><div class="line">      <span class="keywordflow">return</span> CreateFromOptionsAnimal::Cat;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> (animal == <span class="stringliteral">&quot;Dog&quot;</span>) {</div><div class="line">      <span class="keywordflow">return</span> CreateFromOptionsAnimal::Dog;</div><div class="line">    }</div><div class="line">    <a class="code" href="group__OptionParsingGroup.html#ga2724ed7a660af53bf365f99878d79c82">PARSE_ERROR</a>(options.context(),</div><div class="line">                <span class="stringliteral">&quot;CreateFromOptionsAnimal must be &#39;Cat&#39; or &#39;Dog&#39;&quot;</span>);</div><div class="line">  }</div><div class="line">};</div></div><!-- fragment --></div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
&copy; Copyright 2017 - 2018
<a href="https://black-holes.org">SXS Collaboration</a>,
<a href="LICENSE.txt" target="_blank">
<span class="hidden-xs">Distributed under the</span>
MIT License</a>
</small></address>
</body>
</html>
